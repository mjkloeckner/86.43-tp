import{S as $,W as ee,P as te,O as ne,A as oe,H as ae,D as re,p as se,G as ie,a as le,T as ce,R as de,L as ue,u as fe,b as O,c as V,v as pe,M as D,C as me,I as Y,k as q,l as ge,h as z,m as we,V as H,F as S}from"./OrbitControls-5nYykTM8.js";import{e as xe,v as ye,f as he}from"./elevation_map2-Co2iZauO.js";import{t as Me,r as ve,p as be}from"./pasto-JkRKC7jR.js";import{t as Le}from"./tree_forbidden_zone_map-PTOsYFl3.js";let p,x,v,b,W,J,k,R,F;const G=100,T=100,U=8,E=-1,m={tierra:{url:Me,object:null},roca:{url:ve,object:null},pasto:{url:be,object:null},elevationMap:{url:xe,object:null},treeForbiddenMap:{url:Le,object:null}};function K(){x.aspect=b.offsetWidth/b.offsetHeight,x.updateProjectionMatrix(),v.setSize(b.offsetWidth,b.offsetHeight)}function Ae(){p=new $,b=document.getElementById("mainContainer"),v=new ee,v.setClearColor(6316128),b.appendChild(v.domElement),x=new te(35,window.innerWidth/window.innerHeight,.1,1e3),x.position.set(100,120,-100),x.lookAt(0,0,0),new ne(x,v.domElement);const e=new oe(16777215);p.add(e),new ae(16777215,0,.25);const t=new re(16777215,1);t.position.set(100,100,100),p.add(t),new se(t,5);const o=new ie(150,150);p.add(o);const n=new le(5);p.add(n),window.addEventListener("resize",K),K()}function Ge(e,t){let o=t*4,n=e.data;return[n[o],n[o+1],n[o+2],n[o+3]]}function w(e,t,o){return Ge(e,o*e.width+t)}function Q(e){const t=Math.floor(e.x);e.y;const o=Math.floor(e.z);let n=w(R,t,o);const a=n[0],r=n[1],c=n[2];return a<=10&&r>=250&&c<=10||a<=80&&r<=80&&c<=80||a>=200&&r>=200&&c>=200?!0:(console.log("("+e.x+", "+e.y+") is valid "),!1)}function Z(e=0){const t=Math.floor(Math.random()*(G-e*2)),o=Math.floor(Math.random()*(T-e*2)),a=w(F,t,o)[0]/255*U;return new H(t+e,a,o+e)}function Te(e){console.log("Generating `"+e+"` instances of tree");let t=4;const o=new me(.3,.3,t,40,40);o.translate(0,t/2,0);const n=new Y;n.copy(o);const a=new D({color:8142592}),r=new q(n,a,e),c=new ge(1.75,40,40),u=new Y;u.copy(c);const y=new D({color:3561513}),h=new q(u,y,e);new z;const f=new z,d=new z,i=new z,s=3;for(let L=0;L<e;L++){let l=Z(s);for(let M=0;Q(l)&&(l=Z(s),M++!=1e3);++M);if(Q(l))continue;const B=.25;l.x-=(G+s+1.5)/2,l.y+=E-B,l.z-=(T+s)/2,f.makeTranslation(l),d.identity(),i.identity();let g=.6+Math.random()*(t/3);d.makeScale(1,g,1),d.premultiply(f),l.y+=g*t,f.makeTranslation(l),i.premultiply(f),r.setMatrixAt(L,d),h.setMatrixAt(L,i)}return console.log("Done generating `"+e+"` instances of tree"),[r,h]}function je(e,t,o,n,a){console.log("Generating terrain geometry");let r=new we;const c=[],u=[],y=[],h=[];let f=F;const d=n-1;for(let i=0;i<n-1;i++)for(let s=0;s<a-1;s++){let l=w(f,i,s)[0]/255;const B=o*l;let g,M,j,A;g=i>0?w(f,i-1,s)[0]/255:void 0,M=i<n-1?w(f,i+1,s)[0]/255:void 0,j=s>0?w(f,i,s+1)[0]/255:void 0,A=s<a-1?w(f,i,s+1)[0]/255:void 0;let I;g==null?I=M-l:A==null?I=g-l:I=(M-g)/2;let P;j==null?P=A-l:A==null?P=j-l:P=(A-j)/2,c.push(e*i/n-e/2),c.push(B),c.push(t*s/a-t/2);let X=new H(e/n,I*o,0),N=new H(0,P*o,t/a);X.normalize(),N.normalize();let C=new H().crossVectors(N,X);y.push(C.x),y.push(C.y),y.push(C.z),h.push(i/(n-1)),h.push(s/(a-1)),!(i==n-2||s==a-2)&&(u.push(i+s*d),u.push(i+1+s*d),u.push(i+1+(s+1)*d),u.push(i+s*d),u.push(i+1+(s+1)*d),u.push(i+(s+1)*d))}return r.setAttribute("position",new S(c,3)),r.setAttribute("normal",new S(y,3)),r.setAttribute("uv",new S(h,2)),r.setIndex(u),r}function Ie(){console.log("Building scene");const e=G,t=T;J=je(e,t,U,G,T),console.log("Applying textures"),W=new fe({uniforms:{dirtSampler:{type:"t",value:m.tierra.object},rockSampler:{type:"t",value:m.roca.object},grassSampler:{type:"t",value:m.pasto.object},scale:{type:"f",value:3},terrainAmplitude:{type:"f",value:U},terrainAmplitudeBottom:{type:"f",value:E},worldNormalMatrix:{type:"m4",value:null},dirtStepWidth:{type:"f",value:.2},rockStepWidth:{type:"f",value:.15}},vertexShader:ye,fragmentShader:he,side:O}),W.needsUpdate=!0,k=new V(J,W),k.position.set(0,E,0),p.add(k);const o=new pe(e/2,t-1.55),n=new D({color:1223679,side:O}),a=new V(o,n);a.rotateX(Math.PI/2),a.position.set(0,.75,-1),p.add(a);const[r,c]=Te(250);p.add(r),p.add(c)}function Pe(e,t){t.wrapS=t.wrapT=de,m[e].object=t,console.log("Texture `"+e+"` loaded")}function ze(e){const t=new ue;t.onLoad=()=>{console.log("All textures loaded"),e()};for(const o in m){console.log("Loading textures");const n=new ce(t),a=m[o];a.object=n.load(a.url,Pe.bind(this,o),null,r=>{console.error(r)})}}function _(){requestAnimationFrame(_),v.render(p,x)}function He(){console.log("Loading maps data");let e=document.createElement("canvas"),t=e.getContext("2d"),o=m.treeForbiddenMap.object.image,n=m.elevationMap.object.image;const a=G,r=T;e.width=a,e.height=r,t.drawImage(o,0,0,a,r),R=t.getImageData(0,0,a,r),R.data,t.drawImage(n,0,0,a,r),F=t.getImageData(0,0,a,r),F.data,console.log("All maps data loaded succesfully")}function Fe(){He(),Ie(),_()}Ae();ze(Fe);
